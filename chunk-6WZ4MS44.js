import{a as nt}from"./chunk-IQJO5IX2.js";import{b as at,c as rt,d as ct,e as st,f as lt,g as pt,h as dt}from"./chunk-JUGY2JGS.js";import{a as it,b as ot}from"./chunk-CNKM7RGE.js";import{C as tt,F as et,a as V,d as Q,i as z,k as U,o as H,p as $,t as G,v as X,w as Y,y as Z}from"./chunk-AIPMVXUC.js";import{C as s,D as T,E as S,Ha as r,Ia as w,Ja as l,K as u,Na as R,Nb as v,Oa as N,Ob as P,Pb as L,Q as c,Sa as x,U as I,W as b,cb as A,db as h,fa as g,ga as f,gb as j,hc as J,i as _,ic as K,ja as p,jb as q,jc as W,ka as n,la as a,lb as F,ma as C,o as y,q as B,qa as E,sa as d,ua as O,y as D}from"./chunk-J7G3BXWQ.js";var m=class i{config=s(L);baseUrl=this.config.getBaseUrl();http=s(j);getConcertById(t){return this.http.get(this.baseUrl+"concerts/Concert/"+t)}buyTickets(t,e){return this.http.post(this.baseUrl+"sales",{concertId:t,ticketsQuantity:e})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})};function Mt(i,t){i&1&&(n(0,"div",6),r(1,"Cannot buy more than available tickets."),a())}function _t(i,t){i&1&&r(0," Processing... ")}function yt(i,t){i&1&&r(0," Confirm Purchase ")}var k=class i{constructor(t){this.data=t}concertService=s(m);dialogRef=s(at);snackBar=s(J);quantity=u(1);isBusy=u(!1);totalPrice=x(()=>this.data.unitPrice*this.quantity());isValidConfirmation=x(()=>{let t=this.quantity();return t>0&&t<=this.data.ticketsQuantity&&!this.isBusy()});buy(){if(this.quantity()>this.data.ticketsQuantity){this.snackBar.open(`Only ${this.data.ticketsQuantity} tickets available.`,"Close",{duration:3e3,panelClass:["error-snackbar"]});return}this.isBusy.set(!0),this.concertService.buyTickets(this.data.id.toString(),this.quantity()).pipe(y(t=>(console.error(t),this.snackBar.open(t.error?.errorMessage||"Error processing purchase","Close",{duration:3e3,panelClass:["error-snackbar"]}),_(null))),B(()=>this.isBusy.set(!1))).subscribe(t=>{t&&t.success?(this.snackBar.open("Tickets purchased successfully!","Close",{duration:3e3,panelClass:["success-snackbar"]}),this.dialogRef.close(!0)):t&&this.snackBar.open(t.errorMessage||"Purchase failed","Close",{duration:3e3,panelClass:["error-snackbar"]})})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||i)(I(rt))};static \u0275cmp=b({type:i,selectors:[["app-buy-ticket"]],decls:23,vars:14,consts:[["mat-dialog-title",""],[1,"buy-container"],[1,"price-info"],[1,"stock-info"],["appearance","fill"],["matInput","","type","number","min","1",3,"ngModelChange","max","ngModel","disabled"],[1,"error-msg"],[1,"total-section"],["align","end"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(e,o){e&1&&(n(0,"h2",0),r(1),a(),n(2,"mat-dialog-content")(3,"div",1)(4,"p",2),r(5),a(),n(6,"p",3),r(7),a(),n(8,"mat-form-field",4)(9,"mat-label"),r(10,"Quantity"),a(),n(11,"input",5),d("ngModelChange",function(gt){return o.quantity.set(gt)}),a()(),g(12,Mt,2,0,"div",6),n(13,"div",7)(14,"h3"),r(15),R(16,"number"),a()()()(),n(17,"mat-dialog-actions",8)(18,"button",9),d("click",function(){return o.close()}),r(19,"Cancel"),a(),n(20,"button",10),d("click",function(){return o.buy()}),g(21,_t,1,0)(22,yt,1,0),a()()),e&2&&(c(),l("Buy Tickets for ",o.data.title),c(4),l("Unit Price: $",o.data.unitPrice),c(2),l("Available: ",o.data.ticketsQuantity),c(4),p("max",o.data.ticketsQuantity)("ngModel",o.quantity())("disabled",o.isBusy()),c(),f(o.quantity()>o.data.ticketsQuantity?12:-1),c(3),l("Total: $",N(16,11,o.totalPrice(),"1.2-2")),c(3),p("disabled",o.isBusy()),c(2),p("disabled",!o.isValidConfirmation()),c(),f(o.isBusy()?21:22))},dependencies:[h,dt,st,pt,lt,P,v,et,tt,Z,ot,it,G,V,U,Q,$,H,z,K,A],styles:[".buy-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;min-width:300px;padding-top:10px}.price-info[_ngcontent-%COMP%], .stock-info[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;color:#666;margin:0}.stock-info[_ngcontent-%COMP%]{font-size:.9em;color:#888}.total-section[_ngcontent-%COMP%]{border-top:1px solid #ccc;padding-top:10px;text-align:right}.total-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333}.error-msg[_ngcontent-%COMP%]{color:#f44336;font-size:.85em;margin-top:-10px}"]})};function bt(i,t){if(i&1){let e=E();C(0,"app-concert-card",4),n(1,"div",5)(2,"div",6)(3,"span"),r(4,"Acerca del evento"),a(),C(5,"br")(6,"br"),n(7,"p"),r(8),a()(),n(9,"div",7)(10,"span",8),r(11,"Precio: "),n(12,"span"),r(13),a()(),n(14,"button",9),d("click",function(){T(e);let M=O();return S(M.openBuyDialog())}),r(15," Buy Ticket "),a()()()}if(i&2){let e=O();p("data",e.concert),c(8),w(e.concert.description),c(5),l("$",e.concert.unitPrice.toFixed(2))}}var ut=class i{concert;isDetail=u(!1);authService=s(W);router=s(F);matDialog=s(ct);eventId="";activatedRouter=s(q);concertsService=s(m);ngOnInit(){this.eventId=this.activatedRouter.snapshot.params.id,this.concertsService.getConcertById(this.eventId).pipe(y(t=>(console.log("error: ",t),alert(t.error.errorMessage),_()))).subscribe(t=>{this.isDetail.set(!0),this.concert=t.data})}openBuyDialog(){this.matDialog.open(k,{data:this.concert})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=b({type:i,selectors:[["app-event-detail"]],decls:9,vars:1,consts:[[1,"page-container"],[1,"container"],[1,"title-container"],[1,"content"],[3,"data"],[1,"panel-container"],[1,"description"],[1,"actions"],[1,"price"],["mat-raised-button","","color","primary",3,"click"]],template:function(e,o){e&1&&(n(0,"div",0),C(1,"app-header"),n(2,"div",1)(3,"div",2)(4,"span"),r(5,"Buy Tickets and enjoy!"),a()(),n(6,"div",3),g(7,bt,16,3),a()(),C(8,"app-footer"),a()),e&2&&(c(7),f(o.isDetail()?7:-1))},dependencies:[X,Y,nt,P,v,h],styles:[".page-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100%}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;height:100%}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .title-container[_ngcontent-%COMP%]{width:1000px;font-size:16px;font-weight:500;margin-top:40px;margin-bottom:60px}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;width:100%;max-width:1000px}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .panel-container[_ngcontent-%COMP%]{width:750px;background-color:var(--secondary-color);margin-left:30px;display:flex;flex-direction:column;justify-content:space-between;border-radius:8px;padding:20px}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .panel-container[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--primary-color);font-weight:500;font-size:16px}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .panel-container[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden;-webkit-line-clamp:11;line-clamp:11}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .panel-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{color:#fff;margin-right:20px;font-size:16px;font-weight:500}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .panel-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--accent-color)}.page-container[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .panel-container[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--accent-color);color:#fff}"]})};export{ut as EventDetail};
